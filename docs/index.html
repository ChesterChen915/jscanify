<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>照片剪裁測試工具</title>

    <style>
        html, body {
            margin: 0;
        }

        * {
            font-family: system-ui;
        }

        h1{
            font-weight: 400;
        }

        canvas {
            max-height: 600px;
            max-width: 600px;
        }
    </style>
</head>

<body>
    <div style="padding: 30px">
        <h1 style="margin: 0">測試剪裁工具</h1>

        <input type="file" accept="image/*" capture="camera" id="fileInput">
        <!-- file input for capturing images -->

        <canvas id="canvas"></canvas>
        <!-- original image -->
        <canvas id="result"></canvas>
        <!-- highlighted image -->
    </div>

    <script src="https://docs.opencv.org/4.7.0/opencv.js" async></script>
    <!-- warning: loading OpenCV can take some time. Load asynchronously -->
    <script src="https://cdn.jsdelivr.net/gh/ColonelParrot/jscanify@master/src/jscanify.min.js"></script>

    <script>
        window.addEventListener("load", function () {
            const scanner = new jscanify();
            const canvas = document.getElementById("canvas");
            const canvasCtx = canvas.getContext("2d");

            const fileInput = document.getElementById("fileInput");

            fileInput.addEventListener("change", function (event) {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function (e) {
                        const image = new Image();
                        image.src = e.target.result;

                        image.onload = function () {
                            canvas.width = image.width;
                            canvas.height = image.height;

                            // Draw the image on the canvas
                            canvasCtx.drawImage(image, 0, 0);

                            // Highlight the paper and draw it on the same canvas
                            const resultCanvas = scanner.highlightPaper(canvas);
                            canvasCtx.clearRect(0, 0, canvas.width, canvas.height);  // Clear the canvas
                            canvasCtx.drawImage(resultCanvas, 0, 0);  // Draw the highlighted paper
                        };
                    };
                    reader.readAsDataURL(file);
                }
            });
        });

        function clearData() {
            highlighted.querySelector("canvas")?.remove();
            extracted.querySelector("canvas")?.remove();
        }
    </script>
</body>
</html>
